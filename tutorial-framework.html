<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <!-- Basic -->
    <title>Understanding the Nova Framework | Nova Docs</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="https://www.meteor.com/favicon.png" sizes="16x16 32x32 64x64">

    <!-- Social -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://nova-docs.telescopeapp.org">
    <meta property="og:title" content="Understanding the Nova Framework | Nova Docs">
    <meta property="og:description" content="">
    <meta property="og:image" content="">
    <meta name="twitter:card" content="summary_image_large">
    <meta name="twitter:site" content="@telescopeapp">
    <meta name="twitter:title" content="Understanding the Nova Framework | Nova Docs">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="">

    <!-- Misc -->
    <meta name="google-site-verification" content="" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,300italic,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/style/style.css">
  </head>
  <body class="">
    

<div class="nav dark">
  <div class="nav-group">
    <div class="nav-item show-mobile">
      <span class="js-sidebar-toggle ">
        <span class="icon-menu"></span>
      </span>
    </div>
    <div class="nav-item">
      <a class="logo-wrapper" href="http://nova-docs.telescopeapp.org/" title="Nova Documentation Nova Documentation"  >
        Nova Documentation
      </a>
    </div>
  </div>

  <div class="nav-group right">
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="https://github.com/telescopejs/telescope"  >
          <span>GitHub</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://slack.telescopeapp.org"  >
          <span>Slack</span>
        </a>
      </div>
    
  </div>
</div>

<div class="sidebar">
  <div class="panel">
    <div class="panel-item">
      <a class="" href="http://nova-docs.telescopeapp.org/" title="Nova Documentation"  >
        <span>Nova Documentation Nova Documentation</span>
      </a>
    </div>
    
      <div class="panel-item "">
        <a class="" href="https://github.com/telescopejs/telescope"  >
          <span>GitHub</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://slack.telescopeapp.org"  >
          <span>Slack</span>
        </a>
      </div>
    
  </div>

  <div class="sidebar-content">
    <div class="topcap">
      <span class="title-sidebar">Nova Docs</span>
      
    </div>

    

    <ul class="toc">
      
        <li>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="index.html" class="sidebar-link ">
                  <span>Introduction</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Overview</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="features.html" class="sidebar-link ">
                  <span>Features</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="architecture.html" class="sidebar-link ">
                  <span>Architecture</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">API</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="theming.html" class="sidebar-link ">
                  <span>Components & Theming</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="schema.html" class="sidebar-link ">
                  <span>Schema</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="data-layer.html" class="sidebar-link ">
                  <span>Data Layer</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="forms.html" class="sidebar-link ">
                  <span>Forms</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="callbacks.html" class="sidebar-link ">
                  <span>Callbacks</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="email.html" class="sidebar-link ">
                  <span>Email</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="groups-permissions.html" class="sidebar-link ">
                  <span>Groups & Permissions</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="routing.html" class="sidebar-link ">
                  <span>Routing</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="internationalization.html" class="sidebar-link ">
                  <span>Internationalization</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="settings.html" class="sidebar-link ">
                  <span>Settings</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Resources</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="learn.html" class="sidebar-link ">
                  <span>Learn More</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="examples.html" class="sidebar-link ">
                  <span>Examples</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="plugins.html" class="sidebar-link ">
                  <span>Plugins</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="themes.html" class="sidebar-link ">
                  <span>Themes</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="tutorials.html" class="sidebar-link ">
                  <span>Tutorials</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="videos.html" class="sidebar-link ">
                  <span>Videos</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Tutorials</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc  current">
                <a href="" class="sidebar-link  current">
                  <span>Understanding the Nova Framework</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="tutorial-customizing.html" class="sidebar-link ">
                  <span>Customizing & Extending Nova</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="migration.html" class="sidebar-link ">
                  <span>Migration Guide</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="deployment.html" class="sidebar-link ">
                  <span>Deployment Guide</span>
                </a>
              </li>
            
          </ul>
        </li>
      
    </ul>
  </div>
</div>

<div class="content">
  <div class="content-wrapper">
    <div class="header-content">
      <h1 class="title-page">Understanding the Nova Framework</h1>
      

      <div class="page-actions">
        <div class="actions-group">
          <a class="btn tertiary small round lowercase" href="https://github.com/telescopejs/nova-docs/tree/master/source/tutorial-framework.md" target="_blank"><span class="icon-github"></span> <span>Edit on GitHub</span></a>
          
        </div>
      </div>
    </div>

    <div class="document-formatting">
      <p>Out of the box, Nova comes with many features such as handling posts and comments, generating a newsletter, and much more. </p>
<p>But it’s important to understand that you can also use the underlying framework powering these features directly and build a completely different type of app. </p>
<p>So in this tutorial, we’ll focus on understanding this framework and seeing how to build a simple paginated list of movies. </p>
<p>The completed code for this tutorial can be found in the <code>framework-demo</code> package.</p>
<h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><iframe width="560" height="315" src="https://www.youtube.com/embed/RzoYVqsD9WI" frameborder="0" allowfullscreen></iframe>

<h2 id="Set-Up"><a href="#Set-Up" class="headerlink" title="Set Up"></a>Set Up</h2><p>First, we’ll make sure we’re only including the Nova features we actually need. We can do that by removing any non-core packages in the <code>.meteor/packages</code> file (don’t worry, this will only make sure these packages are not loaded, and won’t actually remove them from your codebase). </p>
<p>It should now look like this:</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">############ Nova Core ############</span><br><span class="line"></span><br><span class="line">nova:core                       # core components and wrappers</span><br><span class="line">nova:forms                      # auto-generated forms</span><br><span class="line">nova:routing                    # routing and server-side rendering</span><br><span class="line">nova:email                      # email</span><br><span class="line">nova:users                      # user management and permissions</span><br><span class="line"></span><br><span class="line">nova:base-styles        # default styling</span><br><span class="line">nova:i18n-en-us         # default language translation</span><br><span class="line"></span><br><span class="line">accounts-password@<span class="number">1.3</span><span class="number">.3</span></span><br></pre></td></tr></table></figure>
<p>We’ll keep <code>base-styles</code> to provide some basic Bootstrap styles for forms and menus, as well as <code>i18n-en-us</code> since it contains strings for core UI features. </p>
<p>We’ll also include the official <code>accounts-password</code> package to activate password log in.</p>
<h2 id="Creating-a-Package"><a href="#Creating-a-Package" class="headerlink" title="Creating a Package"></a>Creating a Package</h2><p>The next step will be creating a Meteor package to hold our code. Create a new <code>my-package</code> directory under <code>/packages</code>. We’ll use the following file structure:</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">my-package</span><br><span class="line">  <span class="class"><span class="keyword">lib</span></span></span><br><span class="line">    client</span><br><span class="line">      - main.js</span><br><span class="line">    components</span><br><span class="line">    modules</span><br><span class="line">      - index.js</span><br><span class="line">    server</span><br><span class="line">      - main.js</span><br><span class="line">    - style.css</span><br><span class="line">  - package.js</span><br></pre></td></tr></table></figure>
<ul>
<li><code>package.js</code> is your package manifest, and it tells Meteor which files to load.</li>
<li><code>client/main.js</code> and <code>server/main.js</code> are the client and server entry points.</li>
<li><code>modules/index.js</code> lists all the various modules that make up our package. </li>
<li><code>style.css</code> contains all our styles.</li>
</ul>
<p>Set up all six directories along with five blank files. Once this is done, let’s start with the <code>package.js</code> file:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Package.describe(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'my-package'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Package.onUse(<span class="function"><span class="keyword">function</span> (<span class="params">api</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  api.use([</span><br><span class="line">    <span class="string">'nova:core'</span>,</span><br><span class="line">    <span class="string">'nova:forms'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'std:accounts-ui@1.2.19'</span>,</span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">  api.addFiles(<span class="string">'lib/style.css'</span>, <span class="string">'client'</span>);</span><br><span class="line"></span><br><span class="line">  api.mainModule(<span class="string">'lib/server/main.js'</span>, <span class="string">'server'</span>);</span><br><span class="line">  api.mainModule(<span class="string">'lib/client/main.js'</span>, <span class="string">'client'</span>);</span><br><span class="line"></span><br><span class="line">  api.export([</span><br><span class="line">    <span class="string">'Movies'</span>,</span><br><span class="line">  ], [<span class="string">'client'</span>, <span class="string">'server'</span>]);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>The <code>api.use</code> block defines our package’s dependencies: <code>nova:core</code>, <code>nova:forms</code>, and <code>std:accounts-ui</code>, a package that provides a set of React components for managing log in and sign up. </p>
<p>We then define our two client and server endpoints using <code>api.mainModule</code>. Create <code>lib/client/main.js</code> and <code>lib/server/main.js</code>, and paste in the following line in both:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'../modules/index.js'</span>;</span><br></pre></td></tr></table></figure>
<p>Finally, let’s paste in a few simple styles to make our little demo look better. Create <code>style.css</code> inside <code>lib</code>:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.accounts-ui</span>, <span class="selector-class">.document-new</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.accounts-ui</span> <span class="selector-tag">label</span>&#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.accounts-ui</span> <span class="selector-class">.buttons</span> <span class="selector-tag">a</span>, <span class="selector-class">.accounts-ui</span> <span class="selector-tag">button</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> <span class="number">#ccc</span> solid;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.accounts-ui</span> <span class="selector-tag">button</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#0072DB</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The last step to activate your package is enabling it using the <code>meteor add</code> command to add it to your <code>.meteor/packages</code> file:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor <span class="keyword">add</span><span class="bash"> my-package</span></span><br></pre></td></tr></table></figure>
<p>It may seem like not much happened, but once Meteor restart our custom package will now be active and loaded. </p>
<h2 id="Routing"><a href="#Routing" class="headerlink" title="Routing"></a>Routing</h2><p>We now have the basic structure of our package, so let’s get to work. We’ll create a new component and a new route to display it. </p>
<p>First, create a new <code>components</code> directory inside <code>lib</code> if you haven’t done so yet, and inside it a <code>MoviesWrapper</code> component:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; PropTypes, Component &#125; from 'react';</span><br><span class="line">import &#123; Components, registerComponent &#125; from 'meteor/nova:core';</span><br><span class="line"></span><br><span class="line">const MoviesWrapper = () =&gt; </span><br><span class="line">  &lt;div className="wrapper framework-demo"&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div className="header"&gt;</span><br><span class="line">      Sign up/log in form will go here</span><br><span class="line">    &lt;/div&gt;        </span><br><span class="line">    </span><br><span class="line">    &lt;div className="main"&gt;</span><br><span class="line">      Movie list will go here</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">registerComponent('MoviesWrapper', MoviesWrapper);</span><br></pre></td></tr></table></figure>
<p>Since we’re using the <code>registerComponent</code> function to make it available globally (you can learn more about this in the <a href="/theming.html">Components &amp; Theming</a> section) we don’t actually need to <code>export</code> the component, but we do need to import the file. Let’s create a new <code>component.js</code> file inside <code>modules</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'../components/MoviesWrapper.jsx'</span>;</span><br></pre></td></tr></table></figure>
<p>And import it from <code>index.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./components.js'</span>;</span><br></pre></td></tr></table></figure>
<p>Then, create a new <code>routes.js</code> file inside <code>modules</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; addRoute, getComponent &#125; <span class="keyword">from</span> <span class="string">'meteor/nova:core'</span>;</span><br><span class="line"></span><br><span class="line">addRoute(&#123; <span class="attr">name</span>: <span class="string">'movies'</span>, <span class="attr">path</span>: <span class="string">'movies'</span>, <span class="attr">componentName</span>: <span class="string">'MoviesWrapper'</span> &#125;);</span><br></pre></td></tr></table></figure>
<p>Note: we’re putting our new route at <code>/movies</code> to avoid any conflicts in case the index route is already defined. But if you’d rather have your new page at <code>/</code>, just write <code>path: &#39;/&#39;</code> instead. </p>
<p>Make sure to also import <code>routes.js</code> inside <code>modules/index.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./components.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./routes.js'</span>;</span><br></pre></td></tr></table></figure>
<p>If everything worked properly, you should now be able to head to <code>http://localhost:3000/movies</code> and see your <code>MoviesWrapper</code> component show up. </p>
<h2 id="The-Schema"><a href="#The-Schema" class="headerlink" title="The Schema"></a>The Schema</h2><p>We want to display a list of movies, which means querying for data as well as setting up basic insert, edit, and remove operations. But before we can do any of that, we need to define what a “movie” is. In other words, we need a schema. Check out the <a href="/data-layer.html#schema">Schema</a> section if you want to learn more. </p>
<p>Create <code>schema.js</code> inside <code>modules</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line">  <span class="attr">_id</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">name</span>: &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">'Name'</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">createdAt</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">Date</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">    <span class="attr">autoValue</span>: <span class="function">(<span class="params">documentOrModifier</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (documentOrModifier &amp;&amp; !documentOrModifier.$set) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>() <span class="comment">// if this is an insert, set createdAt to current timestamp  </span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">year</span>: &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">'Year'</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">review</span>: &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">'Review'</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">userId</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">resolveAs</span>: <span class="string">'user: User'</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> schema;</span><br></pre></td></tr></table></figure>
<p>Note that the <code>_id</code> and <code>_userId</code> fields will be set automatically, so we set them to <code>optional: true</code> so that new documents are able to be submitted without them.</p>
<p>We’re also setting up an <code>autoValue</code> function on the <code>createdAt</code> field to initialize it to the current timestamp whenever a new document is inserted. </p>
<p>Finally, we’re setting <code>viewableBy: [&#39;guests&#39;]</code> on every field to make sure they’re visible to non-logged-in users. By default, any schema field is kept private, so we need to make sure we don’t forget this step if we want our data to be publicly accessible.</p>
<h2 id="Setting-Up-a-Collection"><a href="#Setting-Up-a-Collection" class="headerlink" title="Setting Up a Collection"></a>Setting Up a Collection</h2><p>We’re now ready to set up our <code>Movies</code> collection. Create a new <code>collection.js</code> file inside <code>modules</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createCollection &#125; <span class="keyword">from</span> <span class="string">'meteor/nova:core'</span>;</span><br><span class="line"><span class="keyword">import</span> schema <span class="keyword">from</span> <span class="string">'./schema.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Movies = createCollection(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">collectionName</span>: <span class="string">'movies'</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">typeName</span>: <span class="string">'Movie'</span>,</span><br><span class="line"></span><br><span class="line">  schema,</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Movies;</span><br></pre></td></tr></table></figure>
<p>And, as we did previously, reference it from <code>index.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> MoviesImport <span class="keyword">from</span> <span class="string">'./collection.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./components.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./routes.js'</span>;</span><br><span class="line"></span><br><span class="line">Movies = MoviesImport;</span><br></pre></td></tr></table></figure>
<p>Although this is completely optional, we’re defining <code>Movies</code> as a global variable in order to export it to Meteor’s global scope. While global variables are frowned upon in most contexts, exporting <code>Movies</code> makes debugging a lot easier as it makes it accessible inside the browser console and Meteor shell. </p>
<p>At this point it might not look like much has changed, but we now have a functional GraphQL schema! You can see it by opening up the Meteor shell in a terminal window (by typing <code>meteor shell</code> from within your app directory) and typing:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;GraphQLSchema&#125; <span class="keyword">from</span> <span class="string">'meteor/nova:lib'</span></span><br><span class="line">GraphQLSchema.finalSchema</span><br></pre></td></tr></table></figure>
<h2 id="Query-Resolvers"><a href="#Query-Resolvers" class="headerlink" title="Query Resolvers"></a>Query Resolvers</h2><p>Even though we have a schema, we can’t actually query for a document yet because we don’t have any <strong>query resolvers</strong>. In a nutshell, a resolver tells the server how to respond to a specific GraphQL query, and you can learn more about them in the <a href="/data-layer.html#resolvers">Resolvers</a> section. </p>
<p>In this case we want to create two resolvers: one to take in a <code>terms</code> object (which will specify the query terms used to select, filter, and sort the results) and return a list of documents, and one that returns the total number of documents matching these query terms. </p>
<p>Create a new <code>resolvers.js</code> file inside <code>modules</code> and add:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resolvers = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">list</span>: &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">name</span>: <span class="string">'moviesList'</span>,</span><br><span class="line"></span><br><span class="line">    resolver(root, &#123;terms = &#123;&#125;&#125;, context, info) &#123;</span><br><span class="line">      <span class="keyword">let</span> &#123;selector, options&#125; = context.Movies.getParameters(terms);</span><br><span class="line">      options.limit = (terms.limit &lt; <span class="number">1</span> || terms.limit &gt; <span class="number">100</span>) ? <span class="number">100</span> : terms.limit;</span><br><span class="line">      options.fields = context.getViewableFields(context.currentUser, context.Movies);</span><br><span class="line">      <span class="keyword">return</span> context.Movies.find(selector, options).fetch();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">total</span>: &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="attr">name</span>: <span class="string">'moviesTotal'</span>,</span><br><span class="line">    </span><br><span class="line">    resolver(root, &#123;terms = &#123;&#125;&#125;, context) &#123;</span><br><span class="line">      <span class="keyword">let</span> &#123;selector, options&#125; = context.Movies.getParameters(terms);</span><br><span class="line">      <span class="keyword">return</span> context.Movies.find(selector, options).count();</span><br><span class="line">    &#125;,</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> resolvers;</span><br></pre></td></tr></table></figure>
<p>And then import this new file from <code>collection.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createCollection &#125; <span class="keyword">from</span> <span class="string">'meteor/nova:core'</span>;</span><br><span class="line"><span class="keyword">import</span> schema <span class="keyword">from</span> <span class="string">'./schema.js'</span>;</span><br><span class="line"><span class="keyword">import</span> resolvers <span class="keyword">from</span> <span class="string">'./resolvers.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Movies = createCollection(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">collectionName</span>: <span class="string">'movies'</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">typeName</span>: <span class="string">'Movie'</span>,</span><br><span class="line"></span><br><span class="line">  schema,</span><br><span class="line">  </span><br><span class="line">  resolvers,</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Movies;</span><br></pre></td></tr></table></figure>
<p>We can try out our new query resolver using <a href="https://github.com/graphql/graphiql" target="_blank" rel="external">GraphiQL</a>, but first we need some data. Create a new <code>seed.js</code> file inside <code>server</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Movies <span class="keyword">from</span> <span class="string">'../modules/collection.js'</span>;</span><br><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">'meteor/nova:users'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; newMutation &#125; <span class="keyword">from</span> <span class="string">'meteor/nova:core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> seedData = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'Star Wars'</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="string">'1973'</span>,</span><br><span class="line">    <span class="attr">review</span>: <span class="string">`A classic.`</span>,</span><br><span class="line">    <span class="attr">privateComments</span>: <span class="string">`Actually, I don't really like Star Wars…`</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'Die Hard'</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="string">'1987'</span>,</span><br><span class="line">    <span class="attr">review</span>: <span class="string">`A must-see if you like action movies.`</span>,</span><br><span class="line">    <span class="attr">privateComments</span>: <span class="string">`I love Bruce Willis so much!`</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'Terminator'</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="string">'1983'</span>,</span><br><span class="line">    <span class="attr">review</span>: <span class="string">`Once again, Schwarzenegger shows why he's the boss.`</span>,</span><br><span class="line">    <span class="attr">privateComments</span>: <span class="string">`Terminator is my favorite movie ever. `</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'Jaws'</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="string">'1971'</span>,</span><br><span class="line">    <span class="attr">review</span>: <span class="string">'The original blockbuster.'</span>,</span><br><span class="line">    <span class="attr">privateComments</span>: <span class="string">`I'm scared of sharks…`</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'Die Hard II'</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="string">'1991'</span>,</span><br><span class="line">    <span class="attr">review</span>: <span class="string">`Another classic.`</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'Rush Hour'</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="string">'1993'</span>,</span><br><span class="line">    <span class="attr">review</span>: <span class="string">`Jackie Chan at his best.`</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'Citizen Kane'</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="string">'1943'</span>,</span><br><span class="line">    <span class="attr">review</span>: <span class="string">`A disappointing lack of action sequences.`</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'Commando'</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="string">'1983'</span>,</span><br><span class="line">    <span class="attr">review</span>: <span class="string">'A good contender for highest kill count ever.'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">Meteor.startup(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (Users.find().fetch().length === <span class="number">0</span>) &#123;</span><br><span class="line">    Accounts.createUser(&#123;</span><br><span class="line">      <span class="attr">username</span>: <span class="string">'DemoUser'</span>,</span><br><span class="line">      <span class="attr">email</span>: <span class="string">'dummyuser@telescopeapp.org'</span>,</span><br><span class="line">      <span class="attr">profile</span>: &#123;</span><br><span class="line">        <span class="attr">isDummy</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> currentUser = Users.findOne();</span><br><span class="line">  <span class="keyword">if</span> (Movies.find().fetch().length === <span class="number">0</span>) &#123;</span><br><span class="line">    seedData.forEach(<span class="function"><span class="params">document</span> =&gt;</span> &#123;</span><br><span class="line">      newMutation(&#123;</span><br><span class="line">        <span class="attr">action</span>: <span class="string">'movies.new'</span>,</span><br><span class="line">        <span class="attr">collection</span>: Movies,</span><br><span class="line">        <span class="attr">document</span>: <span class="built_in">document</span>, </span><br><span class="line">        <span class="attr">currentUser</span>: currentUser,</span><br><span class="line">        <span class="attr">validate</span>: <span class="literal">false</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>This time, we don’t want to import this on the client, so we’ll import it directly from our <code>server.main.js</code> endpoint:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'../modules/index.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./seed.js'</span>;</span><br></pre></td></tr></table></figure>
<p>Head to <a href="http://localhost:3000/graphiql" target="_blank" rel="external">http://localhost:3000/graphiql</a> and type:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">query moviesQuery&#123;</span><br><span class="line">  moviesList&#123;</span><br><span class="line">    createdAt</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You should get a list of movie names and creation dates on the right. If you’d like, try requesting more fields:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">query moviesQuery&#123;</span><br><span class="line">  moviesList&#123;</span><br><span class="line">    createdAt</span><br><span class="line">    name</span><br><span class="line">    review</span><br><span class="line">    year</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>As you can see, the great thing about GraphQL is that you can specify exactly which piece of data you need!</p>
<h2 id="Displaying-Data"><a href="#Displaying-Data" class="headerlink" title="Displaying Data"></a>Displaying Data</h2><p>Now that we know we can access data from the client, let’s see how to actually load and display it within our app. </p>
<p>We’ll need two pieces for this: a <strong>container</strong> component that loads the data, and a <strong>presentational</strong> component that displays it. Fortunately, Nova comes with a set of built-in container components which we can use out of the box, so we can focus on the presentational components.</p>
<p>Create a new <code>MoviesItem</code> component inside <code>components</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PropTypes, Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Components, registerComponent, withCurrentUser &#125; <span class="keyword">from</span> <span class="string">'meteor/nova:core'</span>;</span><br><span class="line"><span class="keyword">import</span> Movies <span class="keyword">from</span> <span class="string">'../modules/collection.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MoviesItem</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> movie = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;movie.name&#125; (&#123;movie.year&#125;)<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">registerComponent(<span class="string">'MoviesItem'</span>, MoviesItem, withCurrentUser);</span><br></pre></td></tr></table></figure>
<p>We’ll also create a new <code>MoviesList</code> component, which will use a GraphQL fragment to specify what data we want to load:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; PropTypes, Component &#125; from 'react';</span><br><span class="line">import Movies from '../modules/collection.js';</span><br><span class="line">import &#123; Components, registerComponent, withList, withCurrentUser &#125; from 'meteor/nova:core';</span><br><span class="line"></span><br><span class="line">const LoadMore = props =&gt; &lt;a href="#" className="load-more button button--primary" onClick=&#123;e =&gt; &#123;e.preventDefault(); props.loadMore();&#125;&#125;&gt;Load More (&#123;props.count&#125;/&#123;props.totalCount&#125;)&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">class MoviesList extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    if (this.props.loading) &#123;</span><br><span class="line">      return &lt;Components.Loading /&gt;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      const hasMore = this.props.totalCount &gt; this.props.results.length;</span><br><span class="line">      return (</span><br><span class="line">        &lt;div className="movies"&gt;</span><br><span class="line">          &#123;this.props.results.map(movie =&gt; &lt;Components.MoviesItem key=&#123;movie._id&#125; &#123;...movie&#125; currentUser=&#123;this.props.currentUser&#125; refetch=&#123;this.props.refetch&#125; /&gt;)&#125;</span><br><span class="line">          &#123;hasMore ? &lt;LoadMore &#123;...this.props&#125;/&gt; : &lt;p&gt;No more movies&lt;/p&gt;&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const options = &#123;</span><br><span class="line">  collection: Movies,</span><br><span class="line">  queryName: 'moviesListQuery',</span><br><span class="line">  fragmentName: 'MoviesItemFragment',</span><br><span class="line">  limit: 5,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">registerComponent('MoviesList', MoviesList, withList(options), withCurrentUser);</span><br></pre></td></tr></table></figure>
<p>By now you know the drill. At these two new components to <code>components.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'../components/MoviesWrapper.jsx'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'../components/MoviesItem.jsx'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'../components/MoviesList.jsx'</span>;</span><br></pre></td></tr></table></figure>
<p>Then call this component inside <code>MoviesWrapper</code>:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; PropTypes, Component &#125; from 'react';</span><br><span class="line">import &#123; Components, registerComponent &#125; from 'meteor/nova:core';</span><br><span class="line"></span><br><span class="line">const MoviesWrapper = () =&gt; </span><br><span class="line">  &lt;div className="wrapper framework-demo"&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div className="header"&gt;</span><br><span class="line">      Sign up/log in form will go here</span><br><span class="line">    &lt;/div&gt;        </span><br><span class="line">    </span><br><span class="line">    &lt;div className="main"&gt;</span><br><span class="line">      &lt;Components.MoviesList /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">registerComponent('MoviesWrapper', MoviesWrapper);</span><br></pre></td></tr></table></figure>
<h2 id="Fragments"><a href="#Fragments" class="headerlink" title="Fragments"></a>Fragments</h2><p>At this stage, we’ll probably get an error message saying the fragment we’re using is not yet defined. To remedy this, create a new <code>fragments.js</code> file inside <code>modules</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; registerFragment &#125; <span class="keyword">from</span> <span class="string">'meteor/nova:core'</span>;</span><br><span class="line"></span><br><span class="line">registerFragment(<span class="string">`</span><br><span class="line">  fragment MoviesItemFragment on Movie &#123;</span><br><span class="line">    _id</span><br><span class="line">    name</span><br><span class="line">    year</span><br><span class="line">    createdAt</span><br><span class="line">    userId</span><br><span class="line">    user &#123;</span><br><span class="line">      displayName</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">`</span>);</span><br></pre></td></tr></table></figure>
<p>And –as usual— don’t forget to import it within <code>index.js</code>, making sure that it comes <em>before</em> <code>components.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> MoviesImport <span class="keyword">from</span> <span class="string">'./collection.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./fragments.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./components.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./routes.js'</span>;</span><br><span class="line"></span><br><span class="line">Movies = MoviesImport;</span><br></pre></td></tr></table></figure>
<p>Once you save, you should finally get your prize: a shiny new movie list displayed right therte on your screen!</p>
<h2 id="User-Accounts"><a href="#User-Accounts" class="headerlink" title="User Accounts"></a>User Accounts</h2><p>So far so good, but we can’t yet do a lot with our app. In order to give it a little more potential, let’s add user accounts.</p>
<p>Create a new <code>AccountsForm.jsx</code> component inside <code>components</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PropTypes, Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Accounts &#125; <span class="keyword">from</span> <span class="string">'meteor/std:accounts-ui'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withApollo &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; registerComponent &#125; <span class="keyword">from</span> <span class="string">'meteor/nova:core'</span>;</span><br><span class="line"></span><br><span class="line">Accounts.ui.config(&#123;</span><br><span class="line">  <span class="attr">passwordSignupFields</span>: <span class="string">'USERNAME_AND_EMAIL'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AccountsForm = <span class="function">(<span class="params">&#123;client&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Accounts.ui.LoginForm</span> </span><br><span class="line">        <span class="attr">onPostSignUpHook</span>=<span class="string">&#123;()</span> =&gt;</span> client.resetStore()&#125;</span><br><span class="line">        onSignedInHook=&#123;() =&gt; client.resetStore()&#125;</span><br><span class="line">        onSignedOutHook=&#123;() =&gt; client.resetStore()&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">registerComponent('AccountsForm', AccountsForm, withApollo);</span></span><br></pre></td></tr></table></figure>
<p>And hook it up inside <code>MoviesWrapper</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PropTypes, Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Components, registerComponent &#125; <span class="keyword">from</span> <span class="string">'meteor/nova:core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MoviesWrapper = <span class="function"><span class="params">()</span> =&gt;</span> </span><br><span class="line">  &lt;div className=<span class="string">"wrapper framework-demo"</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"header"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Components.AccountsForm</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>        </span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"main"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Components.MoviesList</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">registerComponent('MoviesWrapper', MoviesWrapper);</span></span><br></pre></td></tr></table></figure>
<p>Yay! You can now log in and sign up at your own leisure. And you can also refer to the <a href="https://github.com/studiointeract/accounts-ui/" target="_blank" rel="external">std:accounts-ui</a> package documentation to learn more about setting up accounts.</p>
<h2 id="Mutations"><a href="#Mutations" class="headerlink" title="Mutations"></a>Mutations</h2><p>Now that we’re logged in, we can start interacting with our data. Let’s build a simple form for adding new movies.</p>
<p>Before we can build the user facing part of this feature though, we need to think about how the insertion will be handled server-side, using <a href="/data-layer.html#mutations">Mutations</a>.</p>
<p>Create a new <code>mutations.js</code> file in <code>modules</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; newMutation, Utils &#125; <span class="keyword">from</span> <span class="string">'meteor/nova:core'</span>;</span><br><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">'meteor/nova:users'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> performCheck = <span class="function">(<span class="params">mutation, user, <span class="built_in">document</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!mutation.check(user, <span class="built_in">document</span>)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(Utils.encodeIntlError(&#123;<span class="attr">id</span>: <span class="string">`app.mutation_not_allowed`</span>, <span class="attr">value</span>: <span class="string">`"<span class="subst">$&#123;mutation.name&#125;</span>" on _id "<span class="subst">$&#123;<span class="built_in">document</span>._id&#125;</span>"`</span>&#125;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">new</span>: &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="attr">name</span>: <span class="string">'moviesNew'</span>,</span><br><span class="line">    </span><br><span class="line">    check(user) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!user) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">return</span> Users.canDo(user, <span class="string">'movies.new'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    mutation(root, &#123;<span class="built_in">document</span>&#125;, context) &#123;</span><br><span class="line">      </span><br><span class="line">      performCheck(<span class="keyword">this</span>, context.currentUser, <span class="built_in">document</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> newMutation(&#123;</span><br><span class="line">        <span class="attr">collection</span>: context.Movies,</span><br><span class="line">        <span class="attr">document</span>: <span class="built_in">document</span>, </span><br><span class="line">        <span class="attr">currentUser</span>: context.currentUser,</span><br><span class="line">        <span class="attr">validate</span>: <span class="literal">true</span>,</span><br><span class="line">        context,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> mutations;</span><br></pre></td></tr></table></figure>
<p>This mutation performs a simple check for the presence of a logged-in user, and then passes on the <code>document</code> property to one of Nova’s boilerplate mutations, <code>newMutation</code>. </p>
<p>Let’s pass it on to our <code>createCollection</code> function in <code>collection.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createCollection &#125; <span class="keyword">from</span> <span class="string">'meteor/nova:core'</span>;</span><br><span class="line"><span class="keyword">import</span> schema <span class="keyword">from</span> <span class="string">'./schema.js'</span>;</span><br><span class="line"><span class="keyword">import</span> resolvers <span class="keyword">from</span> <span class="string">'./resolvers.js'</span>;</span><br><span class="line"><span class="keyword">import</span> mutations <span class="keyword">from</span> <span class="string">'./mutations.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Movies = createCollection(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">collectionName</span>: <span class="string">'movies'</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">typeName</span>: <span class="string">'Movie'</span>,</span><br><span class="line"></span><br><span class="line">  schema,</span><br><span class="line">  </span><br><span class="line">  resolvers,</span><br><span class="line"></span><br><span class="line">  mutations,</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Movies;</span><br></pre></td></tr></table></figure>
<p>Note that the mutation’s <code>check</code> function checks if the user can perform an action named <code>movies.new</code>. Let’s take care of this by creating a new <code>permissions.js</code> file:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">'meteor/nova:users'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> membersActions = [</span><br><span class="line">  <span class="string">'movies.new'</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">Users.groups.members.can(membersActions);</span><br></pre></td></tr></table></figure>
<p>And adding it to <code>index.js</code> as usual:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> MoviesImport <span class="keyword">from</span> <span class="string">'./collection.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./fragments.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./components.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./routes.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./mutations.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./permissions.js'</span>;</span><br><span class="line"></span><br><span class="line">Movies = MoviesImport;</span><br></pre></td></tr></table></figure>
<p>You can learn more about all this in the <a href="/groups-permissions.html">Groups &amp; Permissions</a> section.</p>
<p>One more thing! By default, all schema fields are locked down, so we need to specify which ones the user should be able to insert as part of a “new document” operation. </p>
<p>Once again, we do this through the schema. We’ll add an <code>insertableBy</code> property to any “insertable” field and set it to <code>[members]</code> to indicate that a field should be insertable by any member of the <code>members</code> group (in other words, regular logged-in users):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line">  <span class="attr">_id</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">name</span>: &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">'Name'</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">    <span class="attr">insertableBy</span>: [<span class="string">'members'</span>],</span><br><span class="line">    <span class="attr">editableBy</span>: [<span class="string">'members'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">createdAt</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">Date</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">    <span class="attr">autoValue</span>: <span class="function">(<span class="params">documentOrModifier</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (documentOrModifier &amp;&amp; !documentOrModifier.$set) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>() <span class="comment">// if this is an insert, set createdAt to current timestamp  </span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">year</span>: &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">'Year'</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">    <span class="attr">insertableBy</span>: [<span class="string">'members'</span>],</span><br><span class="line">    <span class="attr">editableBy</span>: [<span class="string">'members'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">review</span>: &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">'Review'</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">control</span>: <span class="string">'textarea'</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">    <span class="attr">insertableBy</span>: [<span class="string">'members'</span>],</span><br><span class="line">    <span class="attr">editableBy</span>: [<span class="string">'members'</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">userId</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">    <span class="attr">resolveAs</span>: <span class="string">'user: User'</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> schema;</span><br></pre></td></tr></table></figure>
<p>While we’re at it we’ll also specify which fields can be edited via <code>editableBy</code>. </p>
<p>In this case, the three fields we want users to be able to write to are <code>name</code>, <code>year</code>, and <code>review</code>. Finally, we’ll also give the <code>review</code> field a <code>textarea</code> form control. </p>
<h2 id="Forms"><a href="#Forms" class="headerlink" title="Forms"></a>Forms</h2><p>We now have everything we need to create a new <code>MoviesNewForm.jsx</code> component:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PropTypes, Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> Movies <span class="keyword">from</span> <span class="string">'../modules/collection.js'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Components, registerComponent, withMessages, getFragment &#125; <span class="keyword">from</span> <span class="string">'meteor/nova:core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MoviesNewForm = <span class="function"><span class="params">props</span> =&gt;</span></span><br><span class="line">  &lt;Components.SmartForm </span><br><span class="line">    collection=&#123;Movies&#125;</span><br><span class="line">    mutationFragment=&#123;getFragment(<span class="string">'MoviesItemFragment'</span>)&#125;</span><br><span class="line">  /&gt;</span><br><span class="line"></span><br><span class="line">registerComponent(<span class="string">'MoviesNewForm'</span>, MoviesNewForm, withMessages);</span><br></pre></td></tr></table></figure>
<p>We’ll pass the <code>MoviesItemFragment</code> fragment to the form so that it knows what data to return from the server once the mutation is complete. </p>
<p>Let’s add the form to our component list:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'../components/MoviesWrapper.jsx'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'../components/MoviesItem.jsx'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'../components/MoviesList.jsx'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'../components/AccountsForm.jsx'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'../components/MoviesNewForm.jsx'</span>;</span><br></pre></td></tr></table></figure>
<p>And then call it from <code>MoviesList.jsx</code>:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; PropTypes, Component &#125; from 'react';</span><br><span class="line">import Movies from '../modules/collection.js';</span><br><span class="line">import &#123; Components, registerComponent, withList, withCurrentUser &#125; from 'meteor/nova:core';</span><br><span class="line"></span><br><span class="line">const LoadMore = props =&gt; &lt;a href="#" className="load-more button button--primary" onClick=&#123;e =&gt; &#123;e.preventDefault(); props.loadMore();&#125;&#125;&gt;Load More (&#123;props.count&#125;/&#123;props.totalCount&#125;)&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">class MoviesList extends Component &#123;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line"></span><br><span class="line">    const canCreateNewMovie = Movies.options.mutations.new.check(this.props.currentUser);</span><br><span class="line">    </span><br><span class="line">    if (this.props.loading) &#123;</span><br><span class="line">      return &lt;Components.Loading /&gt;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      const hasMore = this.props.totalCount &gt; this.props.results.length;</span><br><span class="line">      return (</span><br><span class="line">        &lt;div className="movies"&gt;</span><br><span class="line">          &#123;canCreateNewMovie ? &lt;Components.MoviesNewForm/&gt; : null&#125;</span><br><span class="line">          &#123;this.props.results.map(movie =&gt; &lt;Components.MoviesItem key=&#123;movie._id&#125; &#123;...movie&#125; currentUser=&#123;this.props.currentUser&#125; refetch=&#123;this.props.refetch&#125; /&gt;)&#125;</span><br><span class="line">          &#123;hasMore ? &lt;LoadMore &#123;...this.props&#125;/&gt; : &lt;p&gt;No more movies&lt;/p&gt;&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const options = &#123;</span><br><span class="line">  collection: Movies,</span><br><span class="line">  queryName: 'moviesListQuery',</span><br><span class="line">  fragmentName: 'MoviesItemFragment',</span><br><span class="line">  limit: 5,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">registerComponent('MoviesList', MoviesList, withList(options), withCurrentUser);</span><br></pre></td></tr></table></figure>
<p>We only want to show the “New Movie” form when a user actually <em>can</em> submit a new movie, so we’ll make use of the mutation’s <code>check</code> function to figure this out.</p>
<p>We need to access the current user to perform this check, so we’ll use the <code>withCurrentUser</code> higher-order component and use the <code>compose</code> utility to keep the syntax clean. </p>
<p>Now fill out the form and submit it. The query will be updated and the new movie will appear right there in our list! </p>
<h2 id="Sorting"><a href="#Sorting" class="headerlink" title="Sorting"></a>Sorting</h2><p>As it stands, our movie list isn’t really sorted. What if we wanted to sort it by movie year?</p>
<p>To do so, create a <code>parameters.js</code> file (learn more about parameters <a href="/data-layer.html#Terms-Parameters">here</a>):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; addCallback &#125; <span class="keyword">from</span> <span class="string">'meteor/nova:core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sortByCreatedAt</span> (<span class="params">parameters, terms</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">selector</span>: parameters.selector, </span><br><span class="line">    <span class="attr">options</span>: &#123;...parameters.options, <span class="attr">sort</span>: &#123;<span class="attr">createdAt</span>: <span class="number">-1</span>&#125;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">addCallback(<span class="string">"movies.parameters"</span>, sortByCreatedAt);</span><br></pre></td></tr></table></figure>
<p>And add it to <code>index.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> MoviesImport <span class="keyword">from</span> <span class="string">'./collection.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./fragments.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./components.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./routes.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./mutations.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./permissions.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./parameters.js'</span>;</span><br><span class="line"></span><br><span class="line">Movies = MoviesImport;</span><br></pre></td></tr></table></figure>
<h2 id="Going-Further"><a href="#Going-Further" class="headerlink" title="Going Further"></a>Going Further</h2><p>This is probably a good place to stop, but you can go further simply by going through the code of the <code>framework-demo</code> package. In it, you’ll see how to:</p>
<ul>
<li>Create a resolver for single documents so you can load more data for a specific movie.</li>
<li>Add edit and remove mutations (and forms) so you can manage your list.</li>
<li>Use React helpers for quickly creating modal pop-ups. </li>
<li>Use permission checks to enforce fine-grained security throughout your app.</li>
<li>Define GraphQL “joins” in your schema to decorate objects with more data.</li>
</ul>
<p>And this is just the start. You can do a lot more with Nova, Apollo, and React, as you’ll soon see!</p>

    </div>
  </div>

  <div class="pagination">
    <div class="content-wrapper">
      
      
        <a class="link primary prev"
          href="videos.html">
          <span class="icon-arrow-left-alt"></span>
          <span class="subtitle-pagination">Previous</span>
          Videos
        </a>
      
      
        <a class="link primary next"
          href="tutorial-customizing.html">
          <span class="subtitle-pagination">Next</span>
          Customizing & Extending Nova
          <span class="icon-arrow-right-alt"></span>
        </a>
      
    </div>
  </div>

  <div class="github">
    <a class="link tertiary " href="https://github.com/telescopejs/nova-docs/tree/master/source/tutorial-framework.md" target="_blank">
      <span class="icon-github"></span>Edit on GitHub</a>
  </div>

  
</div>

    <script src="/script/smooth-scroll.min.js"></script>
    <script src="/script/main.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>


    <script>
      
    </script>
  </body>
</html>
